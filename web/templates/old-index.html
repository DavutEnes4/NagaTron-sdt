<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFID & I2C Motor Kontrol Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js">
      // MQTT durumunu g√ºncelle
      function updateMQTTStatus() {
        fetch('/api/mqtt-status')
          .then(res => res.json())
          .then(data => {
            const ind = document.getElementById('mqttStatusIndicator');
            const txt = document.getElementById('mqttStatusText');
            if (data.connected) {
              ind.className = 'status-indicator status-connected';
              txt.textContent = 'Baƒülƒ±';
            } else {
              ind.className = 'status-indicator status-disconnected';
              txt.textContent = 'Baƒülƒ± Deƒüil';
            }
          })
          .catch(() => {
            const ind = document.getElementById('mqttStatusIndicator');
            const txt = document.getElementById('mqttStatusText');
            ind.className = 'status-indicator status-disconnected';
            txt.textContent = 'Hata';
          });
      }
      window.addEventListener('load', updateMQTTStatus);
      setInterval(updateMQTTStatus, 5000);

    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-connected { background-color: #10b981; }
        .status-disconnected { background-color: #ef4444; }
        .status-active { background-color: #f59e0b; }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .data-display {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .data-label {
            font-weight: 600;
            color: #4a5568;
        }
        
        .data-value {
            color: #2d3748;
            font-family: monospace;
        }
        
        .history-item {
            background: #f1f5f9;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid #667eea;
        }
        
        .history-time {
            font-size: 12px;
            color: #64748b;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        /* Hata mesajlarƒ±nƒ± gizle */
        .error-hidden {
            display: none !important;
        }
        
        /* Konsol hatalarƒ±nƒ± gizle */
        body::after {
            content: none !important;
        }
        
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 15px 0;
        }
        
        .sensor-value {
            background: #e2e8f0;
            padding: 8px;
            text-align: center;
            border-radius: 6px;
            font-family: monospace;
            font-weight: 600;
        }
        
        .sensor-active {
            background: #10b981;
            color: white;
        }
        
        .motor-speeds {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .speed-indicator {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }
        
        .speed-value {
            font-size: 24px;
            font-weight: bold;
            color: #4a5568;
            margin-top: 5px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .alert-success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        
        .alert-error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        
        .direction-display {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .direction-text {
            font-size: 18px;
            font-weight: bold;
            color: #4a5568;
            text-transform: uppercase;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .sensor-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>RFID & I2C Motor Kontrol Dashboard</h1>
            <p>Deneyap Kart Kontrol ve ƒ∞zleme Sistemi</p>
        </div>

        <div class="dashboard">
    <!-- MQTT Durum Kartƒ± -->
    <div class="card">
      <h2>üîå MQTT Durum</h2>
      <div class="data-display">
        <div class="data-row">
          <span class="data-label">Broker Baƒülƒ± mƒ±?</span>
          <span class="data-value">
            <span id="mqttStatusIndicator" class="status-indicator status-disconnected"></span>
            <span id="mqttStatusText">Baƒülanƒ±yor‚Ä¶</span>
          </span>
        </div>
      </div>
    </div>

            <!-- RFID Kartƒ± -->
            <div class="card">
                <h2>üì± RFID Okuyucu</h2>
                
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label">Son Okunan Kart:</span>
                        <span class="data-value" id="lastCardId">Hen√ºz kart okunmadƒ±</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Okuma Zamanƒ±:</span>
                        <span class="data-value" id="lastReadTime">-</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Toplam Okuma:</span>
                        <span class="data-value" id="totalReads">0</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Toplam Yazma:</span>
                        <span class="data-value" id="totalWrites">0</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>Kart ID:</label>
                    <input type="text" id="writeCardId" placeholder="Kart ID (opsiyonel)">
                </div>
                
                <div class="input-group">
                    <label>Yazƒ±lacak Veri:</label>
                    <input type="text" id="writeData" placeholder="Yazƒ±lacak veriyi girin">
                </div>
                
                <button class="btn" onclick="writeRFID()">üìù RFID'ye Yaz</button>
                
                <div id="rfidAlerts"></div>
            </div>

            <!-- I2C Durum Kartƒ± -->
            <div class="card">
                <h2>üîó I2C Sistem Durumu</h2>
                
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label">I2C Baƒülantƒ±sƒ±:</span>
                        <span class="data-value">
                            <span id="i2cStatus" class="status-indicator status-disconnected"></span>
                            <span id="i2cStatusText">Baƒülƒ± Deƒüil</span>
                        </span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Motor Aktif:</span>
                        <span class="data-value">
                            <span id="motorStatus" class="status-indicator status-disconnected"></span>
                            <span id="motorStatusText">Pasif</span>
                        </span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">QTR Aktif:</span>
                        <span class="data-value">
                            <span id="qtrStatus" class="status-indicator status-disconnected"></span>
                            <span id="qtrStatusText">Pasif</span>
                        </span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Son Ping:</span>
                        <span class="data-value" id="lastPing">-</span>
                    </div>
                </div>
            </div>

            <!-- PID Ayarlarƒ± -->
            <div class="card">
                <h2>‚öôÔ∏è PID Kontrol Ayarlarƒ±</h2>
                
                <div class="input-group">
                    <label>Kp (Proportional):</label>
                    <input type="number" id="pidKp" step="0.1" value="2.0">
                </div>
                
                <div class="input-group">
                    <label>Ki (Integral):</label>
                    <input type="number" id="pidKi" step="0.01" value="0.1">
                </div>
                
                <div class="input-group">
                    <label>Kd (Derivative):</label>
                    <input type="number" id="pidKd" step="0.1" value="0.5">
                </div>
                
                <div class="input-group">
                    <label>Setpoint:</label>
                    <input type="number" id="pidSetpoint" step="1" value="0">
                </div>
                
                <button class="btn" onclick="updatePID()">üîß PID G√ºncelle</button>
                
                <div id="pidAlerts"></div>
            </div>

            <!-- Pin Ayarlarƒ± -->
            <div class="card">
                <h2>üìå Pin Konfig√ºrasyonu</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <div class="input-group">
                            <label>Sol Motor Pin 1:</label>
                            <input type="number" id="motorLeftPin1" value="5">
                        </div>
                        <div class="input-group">
                            <label>Sol Motor Pin 2:</label>
                            <input type="number" id="motorLeftPin2" value="6">
                        </div>
                        <div class="input-group">
                            <label>Sol Enable Pin:</label>
                            <input type="number" id="enableLeft" value="3">
                        </div>
                    </div>
                    <div>
                        <div class="input-group">
                            <label>Saƒü Motor Pin 1:</label>
                            <input type="number" id="motorRightPin1" value="9">
                        </div>
                        <div class="input-group">
                            <label>Saƒü Motor Pin 2:</label>
                            <input type="number" id="motorRightPin2" value="10">
                        </div>
                        <div class="input-group">
                            <label>Saƒü Enable Pin:</label>
                            <input type="number" id="enableRight" value="11">
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="updatePins()">üìå Pin Ayarlarƒ±nƒ± G√ºncelle</button>
                
                <div id="pinAlerts"></div>
            </div>

            <!-- Hƒ±z Kontrol√º -->
            <div class="card">
                <h2>üèÅ Hƒ±z Kontrol Ayarlarƒ±</h2>
                
                <div class="input-group">
                    <label>Temel Hƒ±z:</label>
                    <input type="number" id="baseSpeed" min="0" max="255" value="150">
                </div>
                
                <div class="input-group">
                    <label>Maksimum Hƒ±z:</label>
                    <input type="number" id="maxSpeed" min="0" max="255" value="255">
                </div>
                
                <div class="input-group">
                    <label>Minimum Hƒ±z:</label>
                    <input type="number" id="minSpeed" min="0" max="255" value="50">
                </div>
                
                <button class="btn" onclick="updateSpeed()">üèÅ Hƒ±z Ayarlarƒ±nƒ± G√ºncelle</button>
                
                <div id="speedAlerts"></div>
            </div>

            <!-- Motor Kontrol -->
            <div class="card">
                <h2>üéÆ Motor Kontrol</h2>
                
                <div class="direction-display">
                    <div class="direction-text" id="currentDirection">STOP</div>
                </div>
                
                <div class="motor-speeds">
                    <div class="speed-indicator">
                        <div>Sol Motor</div>
                        <div class="speed-value" id="leftSpeed">0</div>
                    </div>
                    <div class="speed-indicator">
                        <div>Saƒü Motor</div>
                        <div class="speed-value" id="rightSpeed">0</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Manuel Hƒ±z:</label>
                    <input type="range" id="manualSpeed" min="50" max="255" value="150">
                    <span id="speedValue">150</span>
                </div>
                
                <div class="control-grid">
                    <button class="btn btn-success" onclick="motorControl('forward')">‚¨ÜÔ∏è ƒ∞leri</button>
                    <button class="btn btn-warning" onclick="motorControl('left')">‚¨ÖÔ∏è Sol</button>
                    <button class="btn btn-warning" onclick="motorControl('right')">‚û°Ô∏è Saƒü</button>
                    <button class="btn" onclick="motorControl('backward')">‚¨áÔ∏è Geri</button>
                    <button class="btn btn-danger" onclick="motorControl('stop')">‚èπÔ∏è Durdur</button>
                    <button class="btn btn-success" onclick="motorControl('start')">‚ñ∂Ô∏è Ba≈ülat</button>
                </div>
                
                <div id="motorAlerts"></div>
            </div>

            <!-- QTR Sens√∂r Verileri -->
            <div class="card">
                <h2>üëÅÔ∏è QTR Sens√∂r Verileri</h2>
                
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label">√áizgi Pozisyonu:</span>
                        <span class="data-value" id="linePosition">0</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">√áizgi Durumu:</span>
                        <span class="data-value" id="lineDetected">‚ùå Bulunamadƒ±</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Son G√ºncelleme:</span>
                        <span class="data-value" id="qtrLastUpdate">-</span>
                    </div>
                </div>
                
                <h3 style="margin: 15px 0 10px 0;">Sens√∂r Deƒüerleri:</h3>
                <div class="sensor-grid" id="sensorGrid">
                    <!-- Sens√∂r deƒüerleri dinamik olarak eklenecek -->
                </div>
            </div>

            <!-- RFID Ge√ßmi≈üi -->
            <div class="card">
                <h2>üìã RFID ƒ∞≈ülem Ge√ßmi≈üi</h2>
                
                <h3>Son Okumalar:</h3>
                <div id="cardHistory" style="max-height: 200px; overflow-y: auto;">
                    <!-- Dinamik i√ßerik -->
                </div>
                
                <h3 style="margin-top: 20px;">Yazma Ge√ßmi≈üi:</h3>
                <div id="writeHistory" style="max-height: 200px; overflow-y: auto;">
                    <!-- Dinamik i√ßerik -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Socket.IO baƒülantƒ±sƒ±
        const socket = io();
        
        // Baƒülantƒ± olaylarƒ±
        socket.on('connect', function() {
            console.log('Socket.IO baƒülantƒ±sƒ± kuruldu');
        });
        
        socket.on('disconnect', function() {
            console.log('Socket.IO baƒülantƒ±sƒ± kesildi');
        });
        
        // RFID g√ºncellemeleri
        socket.on('rfid_update', function(data) {
            updateRFIDData(data);
        });
        
        socket.on('write_status', function(data) {
            showAlert('rfidAlerts', data.status === 'success' ? 'success' : 'error', 
                      `Yazma ${data.status === 'success' ? 'ba≈üarƒ±lƒ±' : 'ba≈üarƒ±sƒ±z'}: ${data.card_id}`);
        });
        
        // I2C g√ºncellemeleri
        socket.on('i2c_update', function(data) {
            updateI2CData(data);
        });
        
        socket.on('i2c_status_update', function(data) {
            updateSystemStatus(data);
        });
        
        socket.on('motor_update', function(data) {
            updateMotorData(data);
        });
        
        socket.on('qtr_update', function(data) {
            updateQTRData(data);
        });
        
        // Hƒ±z slider g√ºncelleme
        document.getElementById('manualSpeed').addEventListener('input', function() {
            document.getElementById('speedValue').textContent = this.value;
        });
        
        // RFID verisini g√ºncelle
        function updateRFIDData(data) {
            document.getElementById('lastCardId').textContent = data.last_card_id || 'Hen√ºz kart okunmadƒ±';
            document.getElementById('lastReadTime').textContent = data.last_read_time || '-';
            document.getElementById('totalReads').textContent = data.total_reads || 0;
            document.getElementById('totalWrites').textContent = data.total_writes || 0;
            
            // Kart ge√ßmi≈üini g√ºncelle
            const cardHistory = document.getElementById('cardHistory');
            cardHistory.innerHTML = '';
            (data.card_history || []).forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <strong>ID:</strong> ${item.card_id}<br>
                    <strong>Veri:</strong> ${item.data || 'Bo≈ü'}<br>
                    <div class="history-time">${item.time}</div>
                `;
                cardHistory.appendChild(div);
            });
            
            // Yazma ge√ßmi≈üini g√ºncelle
            const writeHistory = document.getElementById('writeHistory');
            writeHistory.innerHTML = '';
            (data.write_history || []).forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.style.borderLeftColor = item.status === 'success' ? '#10b981' : '#ef4444';
                div.innerHTML = `
                    <strong>ID:</strong> ${item.card_id}<br>
                    <strong>Veri:</strong> ${item.data}<br>
                    <strong>Durum:</strong> ${item.status === 'success' ? '‚úÖ Ba≈üarƒ±lƒ±' : '‚ùå Ba≈üarƒ±sƒ±z'}<br>
                    <div class="history-time">${item.time}</div>
                `;
                writeHistory.appendChild(div);
            });
        }
        
        // I2C verilerini g√ºncelle
        function updateI2CData(data) {
            // PID ayarlarƒ±nƒ± g√ºncelle
            if (data.pid_settings) {
                document.getElementById('pidKp').value = data.pid_settings.kp;
                document.getElementById('pidKi').value = data.pid_settings.ki;
                document.getElementById('pidKd').value = data.pid_settings.kd;
                document.getElementById('pidSetpoint').value = data.pid_settings.setpoint;
            }
            
            // Pin ayarlarƒ±nƒ± g√ºncelle
            if (data.pin_settings) {
                document.getElementById('motorLeftPin1').value = data.pin_settings.motor_left_pin1;
                document.getElementById('motorLeftPin2').value = data.pin_settings.motor_left_pin2;
                document.getElementById('motorRightPin1').value = data.pin_settings.motor_right_pin1;
                document.getElementById('motorRightPin2').value = data.pin_settings.motor_right_pin2;
                document.getElementById('enableLeft').value = data.pin_settings.enable_left;
                document.getElementById('enableRight').value = data.pin_settings.enable_right;
            }
            
            // Hƒ±z ayarlarƒ±nƒ± g√ºncelle
            if (data.speed_control) {
                document.getElementById('baseSpeed').value = data.speed_control.base_speed;
                document.getElementById('maxSpeed').value = data.speed_control.max_speed;
                document.getElementById('minSpeed').value = data.speed_control.min_speed;
            }
        }
        
        // Sistem durumunu g√ºncelle
        function updateSystemStatus(data) {
            // I2C durum
            const i2cStatus = document.getElementById('i2cStatus');
            const i2cStatusText = document.getElementById('i2cStatusText');
            if (data.i2c_connected) {
                i2cStatus.className = 'status-indicator status-connected';
                i2cStatusText.textContent = 'Baƒülƒ±';
            } else {
                i2cStatus.className = 'status-indicator status-disconnected';
                i2cStatusText.textContent = 'Baƒülƒ± Deƒüil';
            }
            
            // Motor durum
            const motorStatus = document.getElementById('motorStatus');
            const motorStatusText = document.getElementById('motorStatusText');
            if (data.motor_active) {
                motorStatus.className = 'status-indicator status-active';
                motorStatusText.textContent = 'Aktif';
            } else {
                motorStatus.className = 'status-indicator status-disconnected';
                motorStatusText.textContent = 'Pasif';
            }
            
            // QTR durum
            const qtrStatus = document.getElementById('qtrStatus');
            const qtrStatusText = document.getElementById('qtrStatusText');
            if (data.qtr_active) {
                qtrStatus.className = 'status-indicator status-active';
                qtrStatusText.textContent = 'Aktif';
            } else {
                qtrStatus.className = 'status-indicator status-disconnected';
                qtrStatusText.textContent = 'Pasif';
            }
            
            document.getElementById('lastPing').textContent = data.last_ping || '-';
        }
        
        // Motor verilerini g√ºncelle
        function updateMotorData(data) {
            document.getElementById('leftSpeed').textContent = data.left_speed || 0;
            document.getElementById('rightSpeed').textContent = data.right_speed || 0;
            document.getElementById('currentDirection').textContent = (data.direction || 'stop').toUpperCase();
        }
        
        // QTR verilerini g√ºncelle
        function updateQTRData(data) {
            document.getElementById('linePosition').textContent = data.position || 0;
            document.getElementById('lineDetected').textContent = data.line_detected ? '‚úÖ Bulundu' : '‚ùå Bulunamadƒ±';
            document.getElementById('qtrLastUpdate').textContent = data.last_update || '-';
            
            // Sens√∂r deƒüerlerini g√ºncelle
            const sensorGrid = document.getElementById('sensorGrid');
            sensorGrid.innerHTML = '';
            (data.sensors || [0,0,0,0,0,0,0,0]).forEach((value, index) => {
                const div = document.createElement('div');
                div.className = `sensor-value ${value > 500 ? 'sensor-active' : ''}`;
                div.innerHTML = `S${index + 1}<br>${value}`;
                sensorGrid.appendChild(div);
            });
        }
        
        // RFID yazma
        function writeRFID() {
            const cardId = document.getElementById('writeCardId').value;
            const data = document.getElementById('writeData').value;
            
            if (!data.trim()) {

                return;
            }
            
            socket.emit('write_rfid', {
                card_id: cardId,
                data: data
            });
            

        }
        
        // PID g√ºncelleme
        function updatePID() {
            const pidData = {
                kp: parseFloat(document.getElementById('pidKp').value),
                ki: parseFloat(document.getElementById('pidKi').value),
                kd: parseFloat(document.getElementById('pidKd').value),
                setpoint: parseFloat(document.getElementById('pidSetpoint').value)
            };
            
            socket.emit('update_pid_settings', pidData);

        }
        
        // Pin g√ºncelleme
        function updatePins() {
            const pinData = {
                motor_left_pin1: parseInt(document.getElementById('motorLeftPin1').value),
                motor_left_pin2: parseInt(document.getElementById('motorLeftPin2').value),
                motor_right_pin1: parseInt(document.getElementById('motorRightPin1').value),
                motor_right_pin2: parseInt(document.getElementById('motorRightPin2').value),
                enable_left: parseInt(document.getElementById('enableLeft').value),
                enable_right: parseInt(document.getElementById('enableRight').value)
            };
            
            fetch('/api/update-pins', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(pinData)
            })
            .then(response => response.json())
            .then(data => {

            });
        }
        
        // Motor kontrol
        function motorControl(action) {
            const speed = parseInt(document.getElementById('manualSpeed').value);
            
            socket.emit('motor_command', {
                action: action,
                speed: speed
            });
            

        }
        
        // Alert g√∂sterme
        function showAlert(containerId, type, message) {
            const container = document.getElementById(containerId);
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            container.innerHTML = '';
            container.appendChild(alert);
            
            // 5 saniye sonra alert'i kaldƒ±r
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 5000);
        }
        
        // Socket event'leri i√ßin ba≈üarƒ± mesajlarƒ±
        socket.on('write_sent', function(data) {

        });
        
        socket.on('write_error', function(data) {

        });
        
        socket.on('pid_update_success', function(data) {

        });
        
        socket.on('pid_update_error', function(data) {

        });
        
        socket.on('motor_command_sent', function(data) {

        });
        
        socket.on('motor_command_error', function(data) {

        });
        
        // Sayfa y√ºklendiƒüinde ba≈ülangƒ±√ß verileri al
        window.addEventListener('load', function() {
            // RFID verilerini al
            fetch('/api/rfid-data')
                .then(response => response.json())
                .then(data => updateRFIDData(data))
                .catch(error => console.error('RFID veri alƒ±m hatasƒ±:', error));
            
            // I2C verilerini al
            fetch('/api/i2c-data')
                .then(response => response.json())
                .then(data => {
                    updateI2CData(data);
                    updateSystemStatus(data.system_status);
                    updateMotorData(data.motor_data);
                    updateQTRData(data.qtr_data);
                })
                .catch(error => console.error('I2C veri alƒ±m hatasƒ±:', error));
        });
        
        // Klavye kƒ±sayollarƒ±
        document.addEventListener('keydown', function(event) {
            // Sadece Ctrl tu≈üu ile beraber
            if (event.ctrlKey) {
                switch(event.key) {
                    case 'ArrowUp':
                        event.preventDefault();
                        motorControl('forward');
                        break;
                    case 'ArrowDown':
                        event.preventDefault();
                        motorControl('backward');
                        break;
                    case 'ArrowLeft':
                        event.preventDefault();
                        motorControl('left');
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        motorControl('right');
                        break;
                    case ' ': // Space tu≈üu
                        event.preventDefault();
                        motorControl('stop');
                        break;
                }
            }
        });
        
        // Global hata yakalayƒ±cƒ± - konsol hatalarƒ±nƒ± gizle
        window.addEventListener('error', function(e) {
            console.error('Sayfa hatasƒ±:', e.error);
            return true; // Hatayƒ± gizle
        });
        
        // Promise hatalarƒ±nƒ± yakala
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise hatasƒ±:', e.reason);
            e.preventDefault(); // Hatayƒ± gizle
        });
        
        // Periyodik durum kontrol√º (her 5 saniyede bir)
        setInterval(function() {
            fetch('/api/i2c-data')
                .then(response => response.json())
                .then(data => {
                    updateSystemStatus(data.system_status);
                })
                .catch(error => {
                    // Baƒülantƒ± hatasƒ± durumunda durumlarƒ± g√ºncelle
                    updateSystemStatus({
                        i2c_connected: false,
                        motor_active: false,
                        qtr_active: false,
                        last_ping: 'Baƒülantƒ± Hatasƒ±'
                    });
                });
        }, 5000);
    
      // MQTT durumunu g√ºncelle
      function updateMQTTStatus() {
        fetch('/api/mqtt-status')
          .then(res => res.json())
          .then(data => {
            const ind = document.getElementById('mqttStatusIndicator');
            const txt = document.getElementById('mqttStatusText');
            if (data.connected) {
              ind.className = 'status-indicator status-connected';
              txt.textContent = 'Baƒülƒ±';
            } else {
              ind.className = 'status-indicator status-disconnected';
              txt.textContent = 'Baƒülƒ± Deƒüil';
            }
          })
          .catch(() => {
            const ind = document.getElementById('mqttStatusIndicator');
            const txt = document.getElementById('mqttStatusText');
            ind.className = 'status-indicator status-disconnected';
            txt.textContent = 'Hata';
          });
      }
      window.addEventListener('load', updateMQTTStatus);
      setInterval(updateMQTTStatus, 5000);

    </script>
</body>
</html>
