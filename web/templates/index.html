<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFID & I2C Motor Kontrol Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f8fafc;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: #333;
            font-size: 14px; /* 7 inç için optimize */
        }

        /* Navbar Styles */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
        }

        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
            font-size: 1.2rem;
        }

        .nav-link {
            color: #666 !important;
            font-weight: 500;
            padding: 0.5rem 1rem !important;
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary-color) !important;
            background: rgba(102, 126, 234, 0.1);
        }

        /* Main Container */
        .main-container {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem;
            border: none;
            font-weight: 600;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected { background-color: var(--success-color); }
        .status-disconnected { background-color: var(--danger-color); }
        .status-active { background-color: var(--warning-color); }

        /* Grid System for 7 inch */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        /* RFID Section */
        .rfid-section {
            grid-column: span 2;
        }

        .rfid-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        /* I2C Section */
        .i2c-section {
            grid-column: span 2;
        }

        .i2c-card {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        /* Motor Control Section */
        .motor-section {
            grid-column: span 2;
        }

        .motor-card {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        /* QTR Section */
        .qtr-section {
            grid-column: span 1;
        }

        .qtr-card {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
        }

        /* Buttons */
        .btn-custom {
            border-radius: var(--border-radius);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border: none;
            transition: all 0.3s ease;
            margin: 0.25rem;
        }

        .btn-primary-custom {
            background: var(--primary-color);
            color: white;
        }

        .btn-success-custom {
            background: var(--success-color);
            color: white;
        }

        .btn-warning-custom {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger-custom {
            background: var(--danger-color);
            color: white;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Form Controls */
        .form-control {
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
            padding: 0.5rem;
            font-size: 14px;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        /* Data Display */
        .data-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            margin: 0.5rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .data-label {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .data-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
        }

        /* Sensor Display */
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.25rem;
            margin: 1rem 0;
        }

        .sensor-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 0.5rem;
            text-align: center;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
        }

        .sensor-active {
            background: var(--success-color);
            transform: scale(1.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .rfid-section, .i2c-section, .motor-section {
                grid-column: span 1;
            }
            
            .card-body {
                padding: 1rem;
            }
            
            .btn-custom {
                padding: 0.4rem 0.8rem;
                font-size: 13px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        /* History Tables */
        .history-table {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .history-table th {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 600;
            padding: 0.75rem;
        }

        .history-table td {
            color: white;
            padding: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Motor Control Panel */
        .motor-control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .motor-btn {
            padding: 0.75rem;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .motor-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn-forward { background: var(--success-color); }
        .btn-backward { background: var(--warning-color); }
        .btn-left { background: var(--primary-color); }
        .btn-right { background: var(--secondary-color); }
        .btn-stop { background: var(--danger-color); }
        .btn-emergency { background: #dc2626; }

        /* PID Control Panel */
        .pid-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .pid-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            color: white;
            padding: 0.5rem;
        }

        .pid-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        /* System Status */
        .system-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .status-item {
            text-align: center;
            color: white;
        }

        .status-item i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .status-item.active i {
            color: var(--success-color);
        }

        .status-item.inactive i {
            color: var(--danger-color);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-microchip me-2"></i>
                RFID-I2C Dashboard
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#rfid-section">
                            <i class="fas fa-credit-card me-1"></i>RFID
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#i2c-section">
                            <i class="fas fa-cogs me-1"></i>I2C
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#motor-section">
                            <i class="fas fa-car me-1"></i>Motor
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#qtr-section">
                            <i class="fas fa-eye me-1"></i>QTR
                        </a>
                    </li>
                    <li class="nav-item">
                        <span class="nav-link" id="mqttStatus">
                            <span class="status-indicator status-disconnected" id="mqttStatusIndicator"></span>
                            <span id="mqttStatusText">Bağlı Değil</span>
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- System Status -->
        <div class="system-status">
            <div class="status-item" id="systemStatus">
                <i class="fas fa-server"></i>
                <div>Sistem</div>
            </div>
            <div class="status-item" id="mqttStatusItem">
                <i class="fas fa-wifi"></i>
                <div>MQTT</div>
            </div>
            <div class="status-item" id="rfidStatusItem">
                <i class="fas fa-credit-card"></i>
                <div>RFID</div>
            </div>
            <div class="status-item" id="i2cStatusItem">
                <i class="fas fa-microchip"></i>
                <div>I2C</div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- RFID Section -->
            <div class="rfid-section" id="rfid-section">
                <div class="card rfid-card">
                    <div class="card-header">
                        <i class="fas fa-credit-card me-2"></i>
                        RFID Sistemi
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="data-item">
                                    <div class="data-label">Son Kart ID</div>
                                    <div class="data-value" id="lastCardId">Henüz kart okunmadı</div>
                                </div>
                                <div class="data-item">
                                    <div class="data-label">Toplam Okuma</div>
                                    <div class="data-value" id="totalReads">0</div>
                                </div>
                                <div class="data-item">
                                    <div class="data-label">Toplam Yazma</div>
                                    <div class="data-value" id="totalWrites">0</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label text-white">Kart ID</label>
                                    <input type="text" class="form-control" id="cardIdInput" placeholder="Kart ID (opsiyonel)">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-white">Yazılacak Veri</label>
                                    <textarea class="form-control" id="writeDataInput" rows="3" placeholder="Yazılacak veriyi girin"></textarea>
                                </div>
                                <button class="btn btn-custom btn-success-custom" onclick="writeRFID()">
                                    <i class="fas fa-pen me-1"></i>Karta Yaz
                                </button>
                            </div>
                        </div>
                        
                        <!-- RFID History -->
                        <div class="mt-3">
                            <h6 class="text-white mb-2">Son İşlemler</h6>
                            <div class="history-table">
                                <table class="table table-borderless mb-0">
                                    <thead>
                                        <tr>
                                            <th>Zaman</th>
                                            <th>Kart ID</th>
                                            <th>İşlem</th>
                                            <th>Durum</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rfidHistory">
                                        <tr>
                                            <td colspan="4" class="text-center text-white-50">Henüz işlem yok</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- I2C Section -->
            <div class="i2c-section" id="i2c-section">
                <div class="card i2c-card">
                    <div class="card-header">
                        <i class="fas fa-cogs me-2"></i>
                        I2C Kontrol Sistemi
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="data-item">
                                    <div class="data-label">I2C Bağlantısı</div>
                                    <div class="data-value" id="i2cConnection">Bağlı Değil</div>
                                </div>
                                <div class="data-item">
                                    <div class="data-label">Motor Durumu</div>
                                    <div class="data-value" id="motorStatus">Durdu</div>
                                </div>
                                <div class="data-item">
                                    <div class="data-label">QTR Sensör</div>
                                    <div class="data-value" id="qtrStatus">Pasif</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-white mb-2">PID Ayarları</h6>
                                <div class="pid-panel">
                                    <div>
                                        <label class="form-label text-white">Kp</label>
                                        <input type="number" class="form-control pid-input" id="kpInput" value="2.0" step="0.1">
                                    </div>
                                    <div>
                                        <label class="form-label text-white">Ki</label>
                                        <input type="number" class="form-control pid-input" id="kiInput" value="0.1" step="0.1">
                                    </div>
                                    <div>
                                        <label class="form-label text-white">Kd</label>
                                        <input type="number" class="form-control pid-input" id="kdInput" value="0.5" step="0.1">
                                    </div>
                                    <div>
                                        <label class="form-label text-white">Setpoint</label>
                                        <input type="number" class="form-control pid-input" id="setpointInput" value="0">
                                    </div>
                                </div>
                                <button class="btn btn-custom btn-primary-custom" onclick="updatePID()">
                                    <i class="fas fa-save me-1"></i>PID Güncelle
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Motor Control Section -->
            <div class="motor-section" id="motor-section">
                <div class="card motor-card">
                    <div class="card-header">
                        <i class="fas fa-car me-2"></i>
                        Motor Kontrolü
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="data-item">
                                    <div class="data-label">Sol Motor Hızı</div>
                                    <div class="data-value" id="leftSpeed">0</div>
                                </div>
                                <div class="data-item">
                                    <div class="data-label">Sağ Motor Hızı</div>
                                    <div class="data-value" id="rightSpeed">0</div>
                                </div>
                                <div class="data-item">
                                    <div class="data-label">Yön</div>
                                    <div class="data-value" id="motorDirection">Durdu</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-white mb-2">Motor Kontrolleri</h6>
                                <div class="motor-control-panel">
                                    <button class="motor-btn btn-forward" onclick="motorControl('forward')">
                                        <i class="fas fa-arrow-up"></i><br>İleri
                                    </button>
                                    <button class="motor-btn btn-backward" onclick="motorControl('backward')">
                                        <i class="fas fa-arrow-down"></i><br>Geri
                                    </button>
                                    <button class="motor-btn btn-left" onclick="motorControl('left')">
                                        <i class="fas fa-arrow-left"></i><br>Sol
                                    </button>
                                    <button class="motor-btn btn-right" onclick="motorControl('right')">
                                        <i class="fas fa-arrow-right"></i><br>Sağ
                                    </button>
                                    <button class="motor-btn btn-stop" onclick="motorControl('stop')">
                                        <i class="fas fa-stop"></i><br>Dur
                                    </button>
                                    <button class="motor-btn btn-emergency" onclick="motorControl('emergency_stop')">
                                        <i class="fas fa-exclamation-triangle"></i><br>Acil
                                    </button>
                                </div>
                                
                                <div class="mt-3">
                                    <label class="form-label text-white">Hız</label>
                                    <input type="range" class="form-range" id="speedSlider" min="0" max="255" value="150">
                                    <div class="text-white text-center" id="speedValue">150</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- QTR Section -->
            <div class="qtr-section" id="qtr-section">
                <div class="card qtr-card">
                    <div class="card-header">
                        <i class="fas fa-eye me-2"></i>
                        QTR Sensör
                    </div>
                    <div class="card-body">
                        <div class="data-item">
                            <div class="data-label">Pozisyon</div>
                            <div class="data-value" id="qtrPosition">0</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Çizgi Algılandı</div>
                            <div class="data-value" id="lineDetected">Hayır</div>
                        </div>
                        
                        <h6 class="text-white mb-2 mt-3">Sensör Durumları</h6>
                        <div class="sensor-grid" id="sensorGrid">
                            <!-- Sensörler JavaScript ile doldurulacak -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Socket.IO bağlantısı
        const socket = io();
        
        // Global değişkenler
        let rfidData = {};
        let i2cData = {};
        let motorData = {};
        let qtrData = {};

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            initializeSocket();
            updateMQTTStatus();
            setInterval(updateMQTTStatus, 5000);
        });

        // Socket.IO bağlantısı
        function initializeSocket() {
            socket.on('connect', function() {
                console.log('WebSocket bağlandı');
                showToast('Bağlantı kuruldu', 'success');
            });

            socket.on('disconnect', function() {
                console.log('WebSocket bağlantısı kesildi');
                showToast('Bağlantı kesildi', 'error');
            });

            // RFID güncellemeleri
            socket.on('rfid_update', function(data) {
                rfidData = data;
                updateRFIDDisplay();
            });

            // I2C güncellemeleri
            socket.on('i2c_update', function(data) {
                i2cData = data;
                updateI2CDisplay();
            });

            // Motor güncellemeleri
            socket.on('motor_update', function(data) {
                motorData = data;
                updateMotorDisplay();
            });

            // QTR güncellemeleri
            socket.on('qtr_update', function(data) {
                qtrData = data;
                updateQTRDisplay();
            });

            // Yazma durumu
            socket.on('write_status', function(data) {
                showToast(`Yazma durumu: ${data.status}`, data.status === 'success' ? 'success' : 'error');
            });
        }

        // MQTT durumunu güncelle
        function updateMQTTStatus() {
            fetch('/api/mqtt-status')
                .then(res => res.json())
                .then(data => {
                    const indicator = document.getElementById('mqttStatusIndicator');
                    const text = document.getElementById('mqttStatusText');
                    const statusItem = document.getElementById('mqttStatusItem');
                    
                    if (data.connected) {
                        indicator.className = 'status-indicator status-connected';
                        text.textContent = 'Bağlı';
                        statusItem.className = 'status-item active';
                    } else {
                        indicator.className = 'status-indicator status-disconnected';
                        text.textContent = 'Bağlı Değil';
                        statusItem.className = 'status-item inactive';
                    }
                })
                .catch(() => {
                    const indicator = document.getElementById('mqttStatusIndicator');
                    const text = document.getElementById('mqttStatusText');
                    indicator.className = 'status-indicator status-disconnected';
                    text.textContent = 'Hata';
                });
        }

        // RFID görüntüsünü güncelle
        function updateRFIDDisplay() {
            document.getElementById('lastCardId').textContent = rfidData.last_card_id || 'Henüz kart okunmadı';
            document.getElementById('totalReads').textContent = rfidData.total_reads || 0;
            document.getElementById('totalWrites').textContent = rfidData.total_writes || 0;
            
            // Geçmişi güncelle
            updateRFIDHistory();
        }

        // RFID geçmişini güncelle
        function updateRFIDHistory() {
            const history = document.getElementById('rfidHistory');
            const cardHistory = rfidData.card_history || [];
            const writeHistory = rfidData.write_history || [];
            
            let html = '';
            
            // Son 5 işlemi göster
            const allHistory = [...cardHistory, ...writeHistory]
                .sort((a, b) => new Date(b.time) - new Date(a.time))
                .slice(0, 5);
            
            if (allHistory.length === 0) {
                html = '<tr><td colspan="4" class="text-center text-white-50">Henüz işlem yok</td></tr>';
            } else {
                allHistory.forEach(item => {
                    const time = new Date(item.time).toLocaleTimeString();
                    const type = item.type === 'read' ? 'Okuma' : 'Yazma';
                    const status = item.status || 'Başarılı';
                    const statusClass = status === 'success' ? 'text-success' : 'text-danger';
                    
                    html += `
                        <tr>
                            <td>${time}</td>
                            <td>${item.card_id || '-'}</td>
                            <td>${type}</td>
                            <td class="${statusClass}">${status}</td>
                        </tr>
                    `;
                });
            }
            
            history.innerHTML = html;
        }

        // I2C görüntüsünü güncelle
        function updateI2CDisplay() {
            const systemStatus = i2cData.system_status || {};
            
            document.getElementById('i2cConnection').textContent = 
                systemStatus.i2c_connected ? 'Bağlı' : 'Bağlı Değil';
            
            document.getElementById('motorStatus').textContent = 
                systemStatus.motor_active ? 'Aktif' : 'Durdu';
            
            document.getElementById('qtrStatus').textContent = 
                systemStatus.qtr_active ? 'Aktif' : 'Pasif';
            
            // PID ayarlarını güncelle
            const pidSettings = i2cData.pid_settings || {};
            document.getElementById('kpInput').value = pidSettings.kp || 2.0;
            document.getElementById('kiInput').value = pidSettings.ki || 0.1;
            document.getElementById('kdInput').value = pidSettings.kd || 0.5;
            document.getElementById('setpointInput').value = pidSettings.setpoint || 0;
        }

        // Motor görüntüsünü güncelle
        function updateMotorDisplay() {
            const motor = motorData || {};
            
            document.getElementById('leftSpeed').textContent = motor.left_speed || 0;
            document.getElementById('rightSpeed').textContent = motor.right_speed || 0;
            document.getElementById('motorDirection').textContent = motor.direction || 'Durdu';
        }

        // QTR görüntüsünü güncelle
        function updateQTRDisplay() {
            const qtr = qtrData || {};
            
            document.getElementById('qtrPosition').textContent = qtr.position || 0;
            document.getElementById('lineDetected').textContent = qtr.line_detected ? 'Evet' : 'Hayır';
            
            // Sensör grid'ini güncelle
            updateSensorGrid(qtr.sensors || []);
        }

        // Sensör grid'ini güncelle
        function updateSensorGrid(sensors) {
            const grid = document.getElementById('sensorGrid');
            let html = '';
            
            for (let i = 0; i < 8; i++) {
                const value = sensors[i] || 0;
                const isActive = value > 0;
                const className = isActive ? 'sensor-item sensor-active' : 'sensor-item';
                
                html += `<div class="${className}">${value}</div>`;
            }
            
            grid.innerHTML = html;
        }

        // RFID yazma
        function writeRFID() {
            const cardId = document.getElementById('cardIdInput').value;
            const data = document.getElementById('writeDataInput').value;
            
            if (!data.trim()) {
                showToast('Lütfen yazılacak veriyi girin', 'error');
                return;
            }
            
            socket.emit('write_rfid', {
                card_id: cardId,
                data: data
            });
            
            showToast('Yazma komutu gönderildi', 'info');
            document.getElementById('writeDataInput').value = '';
        }

        // PID güncelleme
        function updatePID() {
            const kp = parseFloat(document.getElementById('kpInput').value);
            const ki = parseFloat(document.getElementById('kiInput').value);
            const kd = parseFloat(document.getElementById('kdInput').value);
            const setpoint = parseFloat(document.getElementById('setpointInput').value);
            
            socket.emit('update_pid_settings', {
                kp: kp,
                ki: ki,
                kd: kd,
                setpoint: setpoint
            });
            
            showToast('PID ayarları güncellendi', 'success');
        }

        // Motor kontrolü
        function motorControl(action) {
            const speed = parseInt(document.getElementById('speedSlider').value);
            
            socket.emit('motor_command', {
                action: action,
                speed: speed
            });
            
            showToast(`Motor komutu: ${action}`, 'info');
        }

        // Hız slider'ı
        document.getElementById('speedSlider').addEventListener('input', function() {
            document.getElementById('speedValue').textContent = this.value;
        });

        // Toast bildirimi göster
        function showToast(message, type = 'info') {
            const container = document.querySelector('.toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.minWidth = '250px';
            
            const bgClass = type === 'success' ? 'bg-success' : 
                           type === 'error' ? 'bg-danger' : 
                           type === 'warning' ? 'bg-warning' : 'bg-info';
            
            toast.innerHTML = `
                <div class="toast-header ${bgClass} text-white">
                    <strong class="me-auto">Bildirim</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            container.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // 3 saniye sonra kaldır
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 3000);
        }

        // Navbar link'lerini aktif hale getir
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.getAttribute('href').startsWith('#')) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
        });
    </script>
</body>
</html> 